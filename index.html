<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Shrimp Runner ‚Äî Anoma x Shrimpers</title>
<meta name="description" content="Endless runner for Anoma x Shrimpers. Choose Shrimp or Wizard, jump obstacles, grab bonuses!">
<meta property="og:title" content="Shrimp Runner ‚Äî by @illonashanum">
<meta property="og:description" content="Endless runner for @anoma x Shrimpers. Choose Shrimp or Wizard, jump obstacles, grab bonuses!">
<meta name="twitter:card" content="summary_large_image">
<style>
  :root{ --bg:#0e1428; --fg:#eaf3ff; --accent:#00ffd0; --ui:#121a38; --line:#233060; }
  html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font-family:ui-monospace,Menlo,Consolas,monospace}
  .wrap{max-width:980px;margin:0 auto;padding:12px;display:flex;flex-direction:column;gap:10px}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
  h1{margin:0;font-size:16px;color:var(--accent)}
  .sub{opacity:.85;font-size:12px}
  .hud{display:flex;gap:10px;flex-wrap:wrap;background:var(--ui);border:1px solid var(--line);padding:8px;border-radius:10px}
  .hud span{background:#0f1733;border:1px solid var(--line);border-radius:8px;padding:4px 8px}
  .btns{display:flex;gap:8px;flex-wrap:wrap}
  button{background:#1a2550;color:var(--fg);border:1px solid #2a3b7b;padding:8px 10px;border-radius:8px;cursor:pointer}
  button:hover{background:#213064}
  .charpick{display:flex;gap:10px;align-items:center}
  .charpick img{width:58px;height:58px;object-fit:contain;background:#0d1533;border:1px solid #223062;border-radius:10px;padding:6px;cursor:pointer;opacity:.85}
  .charpick img.selected{outline:2px solid var(--accent);opacity:1}
  canvas{background:linear-gradient(#0d1428 0%,#0d1428 65%,#0a1022 100%);border:1px solid #243363;border-radius:10px;width:100%;height:auto}
  .touch{display:flex;gap:10px;justify-content:center}
  .touch button{min-width:90px}
  a.link{color:#00ffd0;text-decoration:none}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>ü¶ê Shrimp Runner ‚Äî Anoma x Shrimpers</h1>
      <div class="sub">
        Choose your hero ‚Ä¢ Jump obstacles ‚Ä¢ Beat the high score ¬∑ #AnomaUpward<br>
        creator: <a class="link" href="https://twitter.com/illonashanum" target="_blank" rel="noopener">@illonashanum</a>
      </div>
    </div>
    <div class="btns">
      <button id="btnPause" title="P">‚è∏ Pause</button>
      <button id="btnMute" title="M">üîá Mute</button>
      <button id="btnRestart" title="R">üîÅ Restart</button>
      <button id="btnShare" title="Share score">üì£ Share</button>
    </div>
  </header>

  <div class="hud" role="status" aria-live="polite">
    <span>Score: <b id="score">0</b></span>
    <span>Best: <b id="best">0</b></span>
    <span>Speed: <b id="spd">1.0x</b></span>
    <span style="flex:1;text-align:right">‚Üë/Space: Jump ‚Ä¢ P: Pause ‚Ä¢ M: Mute ‚Ä¢ R: Restart ‚Ä¢ H: Show hitboxes</span>
  </div>

  <div class="charpick">
    <strong>Character:</strong>
    <img id="pickShrimp" src="shrimp.png" alt="Shrimp">
    <img id="pickWizard" src="wizard.png" alt="Wizard">
    <span style="opacity:.8">‚Üê click one, then click the canvas to start</span>
  </div>

  <canvas id="game" width="800" height="360" aria-label="Shrimp Runner game"></canvas>

  <div class="touch">
    <button id="btnJump">üÜô Jump</button>
  </div>
</div>

<script>
(() => {
  const cvs = document.getElementById('game');
  const ctx = cvs.getContext('2d');
  const ui = {
    score: document.getElementById('score'),
    best:  document.getElementById('best'),
    spd:   document.getElementById('spd'),
    pause: document.getElementById('btnPause'),
    mute:  document.getElementById('btnMute'),
    restart: document.getElementById('btnRestart'),
    share: document.getElementById('btnShare'),
    jump:  document.getElementById('btnJump'),
    pickShrimp: document.getElementById('pickShrimp'),
    pickWizard: document.getElementById('pickWizard'),
  };

  // --- Audio ---
  const AC = window.AudioContext || window.webkitAudioContext;
  const actx = AC ? new AC() : null;
  let muted = false;
  function beep(f=700,d=0.05,g=0.05,type='square'){
    if(!actx || muted) return;
    const o=actx.createOscillator(), ga=actx.createGain();
    o.type=type; o.frequency.value=f; ga.gain.value=g;
    o.connect(ga); ga.connect(actx.destination);
    o.start(); o.stop(actx.currentTime + d);
  }
  const sJump =()=>beep(820,0.06,0.05,'triangle');
  const sHit  =()=>beep(220,0.12,0.06,'sawtooth');
  const sGood =()=>beep(980,0.08,0.06,'triangle');
  const sClick=()=>beep(680,0.04,0.04,'square');

  // --- State ---
  const STATE={READY:0,PLAY:1,PAUSE:2,OVER:3};
  let state = STATE.READY;
  const GROUND = cvs.height - 100;

  // Countdown
  let countdown = 0; // detik

  // Debug hitbox
  let showHit = false;

  // Sprites
  const imgShrimp = new Image(); imgShrimp.src = 'shrimp.png';
  const imgWizard = new Image(); imgWizard.src = 'wizard.png';
  let heroImg = imgShrimp;
  function select(el, img){
    heroImg = img;
    [ui.pickShrimp, ui.pickWizard].forEach(n=>n.classList.remove('selected'));
    el.classList.add('selected'); sClick();
  }
  ui.pickShrimp.addEventListener('click',()=>select(ui.pickShrimp, imgShrimp));
  ui.pickWizard.addEventListener('click',()=>select(ui.pickWizard, imgWizard));
  ui.pickShrimp.classList.add('selected');

  const hero = { x:140, y:GROUND, w:86, h:86, vy:0, onGround:true };

  // World
  let t=0, speed=220, score=0, best=parseInt(localStorage.getItem('runner_best')||'0',10);
  ui.best.textContent = best;
  let spawnTimer=0, bonusTimer=3;
  const obstacles = [];

  // Parallax
  const hillsA=[], hillsB=[], clouds=[];
  for(let i=0;i<6;i++) hillsA.push(makeHill(Math.random()*cvs.width, 200+Math.random()*40, 0.6));
  for(let i=0;i<5;i++) hillsB.push(makeHill(Math.random()*cvs.width, 260+Math.random()*40, 0.9));
  for(let i=0;i<10;i++) clouds.push({x:Math.random()*cvs.width, y:40+Math.random()*120, w:30+Math.random()*40});
  function makeHill(x, baseY, scale){ return {x, w:140*scale, h:70*scale, baseY, scale}; }

  // Controls
  addEventListener('keydown',e=>{
    const k=e.key.toLowerCase();
    if(e.key==='ArrowUp'||e.key===' '){ jump(); }
    if(k==='p') togglePause();
    if(k==='m') toggleMute();
    if(k==='r') restart();
    if(k==='h') showHit=!showHit;
    if(state===STATE.READY && (e.key===' '||e.key==='Enter')) start();
  });
  ui.jump.addEventListener('click',()=>jump());
  ui.pause.addEventListener('click',()=>togglePause());
  ui.mute.addEventListener('click',()=>toggleMute());
  ui.restart.addEventListener('click',()=>restart());
  ui.share.addEventListener('click',()=>shareScore());
  cvs.addEventListener('click',()=>{ if(state===STATE.READY) start(); });

  function togglePause(){ if(state===STATE.PLAY){ state=STATE.PAUSE; sClick(); } else if(state===STATE.PAUSE){ state=STATE.PLAY; sClick(); } }
  function toggleMute(){ muted=!muted; ui.mute.textContent=muted?'üîä Unmute':'üîá Mute'; sClick(); }

  function start(){
    if (actx && actx.state==='suspended') actx.resume();
    state=STATE.PLAY; t=0; speed=220; score=0; spawnTimer=0; bonusTimer=3;
    obstacles.length=0; hero.y=GROUND; hero.vy=0; hero.onGround=true;
    countdown = 1.8; // 3..2..1..GO!
    ui.spd.textContent = (speed/220).toFixed(1)+'x'; sClick();
  }
  function restart(){ state=STATE.READY; sClick(); }
  function gameOver(){
    state=STATE.OVER;
    best = Math.max(best, Math.floor(score));
    localStorage.setItem('runner_best', String(best));
    ui.best.textContent = best;
  }
  function jump(){ if(state!==STATE.PLAY) return; if(hero.onGround && countdown<=0){ hero.vy=-460; hero.onGround=false; sJump(); } }
  function shareScore(){
    const text = `My score ${Math.floor(score)} on Shrimp Runner ‚Äî @anoma x Shrimpers by @illonashanum #AnomaUpward #ShrimpersNFT`;
    const url  = location.href;
    if(navigator.share){ navigator.share({title:'Shrimp Runner', text, url}).catch(()=>{}); }
    else { window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`,'_blank'); }
  }

  // Helpers
  function rectsOverlap(a,b){ return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y; }
  function heroBounds(){
    const w = hero.w * 0.55; // lebih kecil = lebih fair
    const h = hero.h * 0.65;
    return { x: hero.x - w/2, y: hero.y - h, w, h }; // baseline ‚Üí ke atas
  }

  function spawnObstacle(){
    const r = Math.random();
    let w=24,h=24,y=GROUND-24;
    if(r<0.5){ w=26; h=26; y=GROUND-26; }
    else { w=36; h=20; y=GROUND-20; }
    obstacles.push({x:cvs.width+40,y,w,h,type:'rock',good:false});
  }
  function spawnBonus(){
    const y = GROUND - (80 + Math.random()*60);
    obstacles.push({x:cvs.width+40,y,w:28,h:28,type:'can',good:true});
  }

  // Loop
  let last=0;
  requestAnimationFrame(function loop(ts){
    requestAnimationFrame(loop);
    if(!last) last=ts;
    let dt=Math.min((ts-last)/1000,0.033); last=ts;

    if(state===STATE.PLAY){
      const frozen = countdown > 0;
      if(countdown>0) countdown -= dt;

      if(!frozen){
        t+=dt; score += dt*(speed/22); ui.score.textContent=Math.floor(score);
        speed=Math.min(480,220+t*14); ui.spd.textContent=(speed/220).toFixed(1)+'x';

        // spawn & move
        spawnTimer -= dt; if(spawnTimer<=0){ spawnObstacle(); spawnTimer=Math.max(0.7,1.3-(speed-220)/200); }
        bonusTimer -= dt; if(bonusTimer<=0){ spawnBonus(); bonusTimer=3.5+Math.random()*2.5; }
        obstacles.forEach(o=>o.x-=speed*dt);
        for(let i=obstacles.length-1;i>=0;i--){ if(obstacles[i].x+obstacles[i].w<-10) obstacles.splice(i,1); }

        // physics
        hero.vy+=1400*dt; hero.y+=hero.vy*dt;
        if(hero.y>=GROUND){ hero.y=GROUND; hero.vy=0; hero.onGround=true; }

        // collisions (with forgiveness)
        const hb = heroBounds();
        for(let i=obstacles.length-1;i>=0;i--){
          const o=obstacles[i];
          const ob = { x:o.x+2, y:o.y+2, w:o.w-4, h:o.h-4 };
          if(rectsOverlap(hb, ob)){
            if(o.good){ score+=150; sGood(); obstacles.splice(i,1); }
            else { sHit(); gameOver(); break; }
          }
        }

        // parallax
        const vA=speed*0.15,vB=speed*0.3,vC=speed*0.18;
        hillsA.forEach(h=>{h.x-=vA*dt;if(h.x+h.w<-20)h.x=cvs.width+80;});
        hillsB.forEach(h=>{h.x-=vB*dt;if(h.x+h.w<-20)h.x=cvs.width+80;});
        clouds.forEach(c=>{c.x-=vC*dt;if(c.x<-c.w-20)c.x=cvs.width+20;});
      }
    }
    draw();
  });

  function draw(){
    // sky
    for(let y=0;y<cvs.height;y+=2){
      const t=y/cvs.height; ctx.fillStyle=`rgb(${10+12*t|0},${18+10*t|0},${42+34*t|0})`; ctx.fillRect(0,y,cvs.width,2);
    }
    // mountains & clouds
    hillsA.forEach(h=>{ ctx.fillStyle="#0b1637"; mountain(h.x,h.baseY,h.w,h.h); });
    hillsB.forEach(h=>{ ctx.fillStyle="#10224f"; mountain(h.x,h.baseY,h.w,h.h); });
    ctx.fillStyle="rgba(255,255,255,0.16)";
    clouds.forEach(c=>{ ctx.fillRect(c.x,c.y,c.w,6); ctx.fillRect(c.x+8,c.y-4,c.w*0.6,5); });
    // ground
    ctx.fillStyle="#0a1124"; ctx.fillRect(0,GROUND,cvs.width,cvs.height-GROUND);
    for(let x=0;x<cvs.width;x+=40){ ctx.fillStyle="#16224a"; ctx.fillRect(x,GROUND-2,20,2); }
    // obstacles
    obstacles.forEach(o=>{
      if(o.type==='can'){ ctx.fillStyle="#ffd54a"; ctx.fillRect(o.x,o.y,o.w,o.h); }
      else{ ctx.fillStyle="#55618a"; ctx.fillRect(o.x,o.y,o.w,o.h); }
    });
    // shadow
    ctx.fillStyle="rgba(0,0,0,0.25)";
    ctx.beginPath(); ctx.ellipse(hero.x,GROUND-4,hero.w*0.45,8,0,0,Math.PI*2); ctx.fill();
    // hero
    const drawW=hero.w,drawH=hero.h; const drawX=hero.x-drawW/2,drawY=hero.y-drawH;
    if(heroImg.complete){ ctx.drawImage(heroImg,drawX,drawY,drawW,drawH); }
    else{ ctx.fillStyle="#ff9aa2"; ctx.fillRect(drawX,drawY,drawW,drawH); }
    // overlays
    if(state===STATE.READY) banner("Click canvas or press SPACE/ENTER to start");
    if(state===STATE.PAUSE) banner("Paused ‚Äî press P to resume");
    if(state===STATE.OVER)  banner("Game Over ‚Äî press R to restart");

    if(countdown>0){
      const n=Math.ceil(countdown);
      banner(n>0? String(n): "GO!");
    }

    // debug hitboxes (toggle: H)
    if(showHit){
      const hb = heroBounds();
      ctx.strokeStyle = '#00ffd0'; ctx.strokeRect(hb.x, hb.y, hb.w, hb.h);
      obstacles.forEach(o=>{
        const ob={x:o.x+2,y:o.y+2,w:o.w-4,h:o.h-4};
        ctx.strokeStyle = (o.type==='can') ? '#ffd54a' : '#ff6a6a';
        ctx.strokeRect(ob.x, ob.y, ob.w, ob.h);
      });
    }
  }

  function mountain(x,baseY,w,h){ ctx.beginPath(); ctx.moveTo(x,baseY); ctx.lineTo(x+w*0.5,baseY-h); ctx.lineTo(x+w,baseY); ctx.closePath(); ctx.fill(); }
  function banner(text){
    ctx.fillStyle="rgba(10,17,40,0.92)"; ctx.fillRect(cvs.width/2-120, cvs.height/2-18, 240, 36);
    ctx.strokeStyle="#243363"; ctx.strokeRect(cvs.width/2-120, cvs.height/2-18, 240, 36);
    ctx.fillStyle="#eaf3ff"; ctx.font="14px monospace"; ctx.textBaseline="middle";
    const w=ctx.measureText(text).width; ctx.fillText(text, cvs.width/2 - w/2, cvs.height/2);
  }
})();
</script>
</body>
</html>
